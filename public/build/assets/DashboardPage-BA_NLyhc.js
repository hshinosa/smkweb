import{j as e}from"./markdown-vendor-CIGiOj7E.js";import{q as V,r as o,a as L,j as K,J as O}from"./inertia-vendor-CFsdYvsV.js";import{A as $}from"./AdminLayout-BGv0ni_W.js";import{M as X}from"./Modal-rJC0U0UH.js";import{L as Z,C as Q,a as Y,b as ee,P as te,c as ae,p as se,d as re,e as le,i as ie}from"./index-Cwr-k27S.js";import{k as oe,F as de,o as ne,q as ce,r as G,m as me,l as I,X as xe,S as pe,s as H,t as he,a as ge,b as ue,E as ye}from"./ui-vendor-DKvpuSCb.js";import"./react-vendor-X_fu8xpB.js";import"./transition-CiB-21bZ.js";import"./app-BjrorLXI.js";import"./index-CjLAxSrQ.js";Q.register(Y,ee,te,ae,se,re,le,ie);const w=({title:d,value:y,icon:c,href:m,color:x="blue"})=>{const p={blue:"bg-accent-yellow/10 text-accent-yellow",green:"bg-green-50 text-green-600",yellow:"bg-accent-yellow/10 text-accent-yellow",purple:"bg-purple-50 text-purple-600"};return e.jsxs(O,{href:m,className:"bg-white rounded-xl shadow-sm border border-gray-100 p-4 sm:p-5 flex items-center gap-3 sm:gap-4 hover:shadow-md hover:border-accent-yellow/20 transition-all duration-200 group",children:[e.jsx("div",{className:`p-3 sm:p-4 rounded-xl ${p[x]} group-hover:scale-110 transition-transform flex-shrink-0`,children:e.jsx(c,{size:24,className:"sm:w-7 sm:h-7"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs sm:text-sm text-gray-500 font-medium",children:d}),e.jsx("p",{className:"text-xl sm:text-2xl font-bold text-gray-900 mt-0.5 sm:mt-1",children:y})]}),e.jsx(ye,{size:18,className:"text-gray-400 group-hover:text-accent-yellow transition-colors flex-shrink-0"})]})},fe=({chartData:d,loading:y,error:c,periodType:m})=>{if(y)return e.jsxs("div",{className:"w-full h-64 sm:h-72 lg:h-80 bg-gray-100 rounded-xl flex flex-col items-center justify-center text-gray-500 p-4",children:[e.jsx("div",{className:"w-8 h-8 sm:w-10 sm:h-10 border-4 border-primary border-t-transparent rounded-full animate-spin mb-3"}),e.jsx("p",{className:"text-sm font-medium",children:"Memuat data chart..."})]});if(c&&(!d||!d.labels||d.labels.length===0))return e.jsxs("div",{className:"w-full h-64 sm:h-72 lg:h-80 bg-red-50 border border-red-200 rounded-xl flex flex-col items-center justify-center text-red-600 p-4 sm:p-6 text-center",children:[e.jsx(G,{className:"w-10 h-10 sm:w-12 sm:h-12 text-red-400 mb-3"}),e.jsx("p",{className:"font-semibold text-base sm:text-lg",children:"Gagal memuat data chart"}),e.jsx("p",{className:"text-sm text-red-500 mt-1",children:c})]});if(!d||!d.labels||!d.data||d.labels.length===0)return e.jsxs("div",{className:"w-full h-64 sm:h-72 lg:h-80 bg-gray-50 border border-gray-200 rounded-xl flex flex-col items-center justify-center text-gray-500 p-4",children:[e.jsx(H,{size:32,className:"sm:w-10 sm:h-10 text-gray-300 mb-3"}),e.jsx("p",{className:"font-medium text-sm sm:text-base",children:"Tidak ada data kunjungan"})]});const x={labels:d.labels,datasets:[{label:`Kunjungan - ${m==="hourly"?"Per Jam":"Per Hari"}`,data:d.data,fill:!0,backgroundColor:"rgba(13, 71, 161, 0.1)",borderColor:"#0D47A1",tension:.4,pointBackgroundColor:"#0D47A1",pointBorderColor:"#fff",pointHoverBackgroundColor:"#fff",pointHoverBorderColor:"#0D47A1",borderWidth:2,pointRadius:3,pointHoverRadius:5}]},p={responsive:!0,maintainAspectRatio:!1,scales:{y:{beginAtZero:!0,ticks:{precision:0,color:"#6B7280",font:{size:11}},grid:{color:"#E5E7EB"}},x:{ticks:{color:"#6B7280",font:{size:10},maxRotation:45,minRotation:0},grid:{display:!1}}},plugins:{legend:{display:!0,position:"bottom",labels:{boxWidth:12,padding:15,color:"#374151",font:{size:11}}},tooltip:{mode:"index",intersect:!1,titleFont:{weight:"bold",size:12},bodyFont:{size:11},padding:10,backgroundColor:"#1F2937",cornerRadius:8}},interaction:{mode:"index",intersect:!1}};return e.jsx("div",{className:"h-64 sm:h-72 lg:h-80 w-full",children:e.jsx(Z,{options:p,data:x})})},u=10;function Me(){const{auth:d,unreadMessagesCount:y}=V().props,[c,m]=o.useState(!1),[x,p]=o.useState([]),[S,C]=o.useState([]),[b,A]=o.useState(""),[h,M]=o.useState("all"),[g,j]=o.useState(1),[v,E]=o.useState(1),[F,D]=o.useState(!1),[T,_]=o.useState([]),[J,z]=o.useState(!1),[a,f]=o.useState({total:null,totalMessage:"Memuat data...",totalLoading:!0,totalError:null,dailyChart:null,chartLoading:!0,chartError:null,lastCached:null,period:"7d",periodType:"daily"}),R=o.useCallback(async t=>{f(l=>({...l,totalLoading:!0,chartLoading:!0,totalError:null,chartError:null,totalMessage:"Memuat data..."}));let i=null,s=null,r="Data kunjungan",N=a.lastCached;try{const l=t==="1d"?1:7,n=await L.get(route("admin.api.cloudflare.stats",{period:l}));i={value:n.data.unique_visitors_total!==void 0?n.data.unique_visitors_total:"N/A",message:n.data.message},n.data.cached_at&&(N=new Date(n.data.cached_at).toLocaleString("id-ID",{dateStyle:"medium",timeStyle:"short"})),n.data.message&&(r=n.data.message)}catch(l){i={value:"Error",message:l.response?.data?.error||"Gagal memuat data"},f(n=>({...n,totalError:i.message,totalLoading:!1}))}try{const l=await L.get(route("admin.api.cloudflare.chart.stats",{period:t}));l.data&&l.data.labels&&l.data.data&&(s={labels:l.data.labels,data:l.data.data},!N&&l.data.cached_at&&(N=new Date(l.data.cached_at).toLocaleString("id-ID",{dateStyle:"medium",timeStyle:"short"})))}catch(l){f(n=>({...n,chartError:l.response?.data?.error||"Gagal memuat chart",chartLoading:!1}))}f(l=>({...l,total:i?i.value:"Error",totalMessage:r,totalLoading:!1,dailyChart:s,chartLoading:!1,lastCached:N,periodType:t==="1d"?"hourly":"daily"}))},[a.lastCached]);o.useEffect(()=>{R(a.period)},[a.period,R]);const W=t=>{f(i=>({...i,period:t}))},P=async(t=1,i=u,s=!1)=>{s?D(!0):z(!0);try{const r=await L.get(route("admin.api.activitylogs.index",{page:t,per_page:i}));s?(p(r.data.data),C(r.data.data),E(r.data.last_page),j(r.data.current_page)):_(r.data.data.slice(0,5))}catch(r){console.error("Activity logs error:",r),toast.error("Gagal memuat log aktivitas. Coba refresh halaman."),s?(p([]),C([])):_([])}finally{s?D(!1):z(!1)}};o.useEffect(()=>{P(1,5,!1)},[]);const q=()=>{P(1,u,!0),m(!0)},B=()=>{m(!1),A(""),M("all")};o.useEffect(()=>{if(!c)return;let t=[...x];if(b){const s=b.toLowerCase();t=t.filter(r=>(r.causer?.username?.toLowerCase()||r.causer?.name?.toLowerCase()||"").includes(s)||r.action?.toLowerCase().includes(s)||r.description?.toLowerCase().includes(s))}const i=new Date;if(h!=="all"){let s;h==="24h"?s=new Date(i.getTime()-24*60*60*1e3):h==="7d"?s=new Date(i.getTime()-7*24*60*60*1e3):h==="30d"&&(s=new Date(i.getTime()-30*24*60*60*1e3)),s&&(t=t.filter(r=>new Date(r.created_at)>=s))}C(t),E(Math.ceil(t.length/u)),j(1)},[b,h,c,x]);const k=S.slice((g-1)*u,g*u),U=[{value:"1d",label:"24 Jam",icon:e.jsx(I,{size:14})},{value:"7d",label:"7 Hari",icon:e.jsx(ue,{size:14})}];return e.jsxs($,{headerTitle:"Dashboard Utama",children:[e.jsx(K,{title:"Admin Dashboard"}),e.jsxs("div",{className:"max-w-screen-2xl mx-auto px-2 sm:px-3 lg:px-4 pb-4 sm:pb-6",children:[e.jsxs("div",{className:"grid grid-cols-1 xs:grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4 mb-4 sm:mb-6",children:[e.jsx(w,{title:"Pesan Baru",value:y||0,icon:oe,href:route("admin.contact-messages.index"),color:"blue"}),e.jsx(w,{title:"Berita Aktif",value:"-",icon:de,href:route("admin.posts.index"),color:"green"}),e.jsx(w,{title:"Total Guru/Staff",value:"-",icon:ne,href:route("admin.teachers.index"),color:"purple"}),e.jsx(w,{title:"Program Studi",value:"3",icon:ce,href:route("admin.program-studi.index"),color:"yellow"})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4 sm:p-5 lg:p-6 mb-4 sm:mb-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-3 mb-4 sm:mb-5",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg sm:text-xl font-bold text-gray-900",children:"Statistik Pengunjung"}),e.jsx("p",{className:"text-xs sm:text-sm text-gray-500 mt-0.5",children:"Data kunjungan website"})]}),e.jsx("div",{className:"flex items-center gap-2 w-full sm:w-auto",children:U.map(t=>e.jsxs("button",{onClick:()=>W(t.value),className:`flex items-center gap-1.5 px-3 py-1.5 sm:px-4 sm:py-2 text-xs sm:text-sm font-medium rounded-lg transition-colors flex-1 sm:flex-none ${a.period===t.value?"bg-primary text-white shadow-sm":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[t.icon," ",t.label]},t.value))})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4 sm:gap-5",children:[e.jsx("div",{className:"bg-blue-50 rounded-xl p-4 sm:p-5 lg:p-6 text-center lg:text-left",children:a.totalLoading?e.jsxs("div",{className:"py-6 sm:py-8",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 sm:h-10 sm:w-10 border-4 border-primary border-t-transparent"}),e.jsx("p",{className:"text-xs sm:text-sm text-gray-500 mt-2",children:"Memuat..."})]}):a.total==="Error"?e.jsxs("div",{className:"py-4 bg-red-50 rounded-lg border border-red-200",children:[e.jsx(G,{className:"w-8 h-8 text-red-500 mx-auto mb-2"}),e.jsx("p",{className:"text-xs sm:text-sm text-red-600",children:"Gagal memuat"})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-3xl sm:text-4xl lg:text-5xl font-bold text-primary",children:typeof a.total=="number"?a.total.toLocaleString():a.total}),e.jsx("p",{className:"text-sm sm:text-base text-gray-600 mt-1",children:"Total Kunjungan"}),e.jsx("p",{className:"text-xs sm:text-sm text-gray-500 mt-1",children:a.period==="1d"?"24 Jam Terakhir":"7 Hari Terakhir"}),a.lastCached&&e.jsxs("p",{className:"text-[10px] sm:text-xs text-gray-400 mt-3",children:["Update: ",a.lastCached]})]})}),e.jsx("div",{className:"lg:col-span-2",children:e.jsx(fe,{chartData:a.dailyChart,loading:a.chartLoading,error:a.chartError&&!a.dailyChart?a.chartError:null,periodType:a.periodType})})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden",children:[e.jsxs("div",{className:"p-4 sm:p-5 border-b border-gray-100 flex flex-col sm:flex-row justify-between items-start sm:items-center gap-3",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900",children:"Aktivitas Terbaru"}),e.jsx("p",{className:"text-xs sm:text-sm text-gray-500 mt-0.5",children:"Log aktivitas sistem"})]}),e.jsxs("button",{onClick:q,className:"flex items-center gap-2 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-darker transition-colors text-xs sm:text-sm font-medium w-full sm:w-auto justify-center",children:[e.jsx(me,{size:16}),"Lihat Semua"]})]}),J?e.jsxs("div",{className:"p-8 sm:p-10 text-center",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-4 border-primary border-t-transparent"}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"Memuat aktivitas..."})]}):T.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider",children:"Admin"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider",children:"Aksi"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider hidden sm:table-cell",children:"Waktu"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100",children:T.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-xs font-semibold text-primary",children:(t.causer?.username||t.causer?.name||"S")[0].toUpperCase()})}),e.jsx("span",{className:"text-xs sm:text-sm font-medium text-gray-900 truncate max-w-[120px] sm:max-w-none",children:t.causer?.username||t.causer?.name||"Sistem"})]})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:e.jsx("span",{className:"inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-700",children:t.action})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap hidden sm:table-cell",children:e.jsx("span",{className:"text-xs sm:text-sm text-gray-500",children:new Date(t.created_at).toLocaleString("id-ID",{day:"2-digit",month:"short",hour:"2-digit",minute:"2-digit"})})})]},t.id))})]})}):e.jsxs("div",{className:"p-8 sm:p-10 text-center",children:[e.jsx(I,{size:32,className:"mx-auto text-gray-300 mb-2"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Belum ada aktivitas"})]})]}),e.jsx(X,{show:c,onClose:B,maxWidth:"full",closeable:!1,children:e.jsxs("div",{className:"bg-white h-[85vh] sm:h-[80vh] flex flex-col rounded-xl sm:rounded-2xl overflow-hidden",children:[e.jsxs("div",{className:"p-4 sm:p-5 border-b border-gray-200 flex flex-col sm:flex-row justify-between items-start sm:items-center gap-3 bg-gray-50",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg sm:text-xl font-bold text-gray-900",children:"Riwayat Aktivitas"}),e.jsx("p",{className:"text-xs sm:text-sm text-gray-500 mt-0.5",children:"Log lengkap aktivitas"})]}),e.jsx("button",{onClick:B,className:"p-2 text-gray-500 hover:text-gray-700 hover:bg-gray-200 rounded-lg transition-colors self-end sm:self-auto",children:e.jsx(xe,{size:20})})]}),e.jsx("div",{className:"p-4 border-b border-gray-200 bg-white",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(pe,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",size:18}),e.jsx("input",{type:"text",placeholder:"Cari...",value:b,onChange:t=>A(t.target.value),className:"w-full pl-10 pr-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary text-sm"})]}),e.jsxs("select",{value:h,onChange:t=>M(t.target.value),className:"py-2.5 px-4 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary text-sm bg-white min-w-[140px]",children:[e.jsx("option",{value:"all",children:"Semua"}),e.jsx("option",{value:"24h",children:"24 Jam"}),e.jsx("option",{value:"7d",children:"7 Hari"}),e.jsx("option",{value:"30d",children:"30 Hari"})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:F?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full py-10",children:[e.jsx("div",{className:"w-10 h-10 border-4 border-primary border-t-transparent rounded-full animate-spin mb-3"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Memuat..."})]}):k.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 sticky top-0",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-500 uppercase",children:"No"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-500 uppercase",children:"Admin"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-500 uppercase",children:"Aksi"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-500 uppercase hidden md:table-cell",children:"Keterangan"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-500 uppercase",children:"Waktu"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100",children:k.map((t,i)=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-xs sm:text-sm text-gray-500",children:(g-1)*u+i+1}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:"text-xs sm:text-sm font-medium text-gray-900",children:t.causer?.username||t.causer?.name||e.jsx("span",{className:"italic text-gray-400",children:"Sistem"})})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:"inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium bg-blue-50 text-blue-700",children:t.action})}),e.jsx("td",{className:"px-4 py-3 hidden md:table-cell",children:e.jsx("span",{className:"text-xs sm:text-sm text-gray-600 max-w-[200px] truncate block",children:t.description||"-"})}),e.jsx("td",{className:"px-4 py-3 text-xs sm:text-sm text-gray-500 whitespace-nowrap",children:new Date(t.created_at).toLocaleString("id-ID",{dateStyle:"medium",timeStyle:"short"})})]},t.id))})]})}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-full py-10",children:[e.jsx(H,{size:40,className:"text-gray-300 mb-2"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Tidak ada data"})]})}),v>1&&e.jsxs("div",{className:"p-4 border-t border-gray-200 bg-gray-50 flex flex-col sm:flex-row justify-between items-center gap-3",children:[e.jsxs("p",{className:"text-xs sm:text-sm text-gray-600",children:[k.length," dari ",S.length]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>j(t=>Math.max(1,t-1)),disabled:g===1,className:"p-2 rounded-lg border border-gray-300 hover:bg-gray-100 disabled:opacity-50",children:e.jsx(he,{size:18})}),e.jsxs("span",{className:"text-xs sm:text-sm px-3 py-1",children:[g," / ",v]}),e.jsx("button",{onClick:()=>j(t=>Math.min(v,t+1)),disabled:g===v,className:"p-2 rounded-lg border border-gray-300 hover:bg-gray-100 disabled:opacity-50",children:e.jsx(ge,{size:18})})]})]})]})})]})]})}export{Me as default};
