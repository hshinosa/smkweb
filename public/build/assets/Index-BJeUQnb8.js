import{j as e}from"./markdown-vendor-CIGiOj7E.js";import{q as W,r,S as X}from"./inertia-vendor-CFsdYvsV.js";import{T as F}from"./TextInput-DXlIWAoE.js";import{I as h}from"./InputLabel-B7Cy73bq.js";import{I as U}from"./InputError-CW7Z9Fko.js";import{P as _}from"./PrimaryButton-BP4GzKQS.js";import{F as B}from"./FileUploadField-DGzk2RBu.js";import{C as H}from"./ContentManagementPage-DVU9nbB8.js";import{M as J}from"./Modal-rJC0U0UH.js";import{z as g}from"./app-BjrorLXI.js";import{g as I}from"./imageUtils-wYQj-GuB.js";import{I as z,e as Y,P as $,T as Q,i as Z,X as ee,V as L}from"./ui-vendor-DKvpuSCb.js";import"./react-vendor-X_fu8xpB.js";import"./typography-ChUjANkt.js";import"./AdminLayout-BGv0ni_W.js";import"./transition-CiB-21bZ.js";import"./index-CjLAxSrQ.js";const te=({item:a})=>{const[m,f]=r.useState(""),[b,p]=r.useState(!1);r.useEffect(()=>{let l="";const d=I(a.url);if(a.type==="photo")l=d;else if(a.type==="video"){const n=d.match(/(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/\s]{11})/);n?l=`https://img.youtube.com/vi/${n[1]}/maxresdefault.jpg`:l=d}f(l)},[a]);const y=l=>{if(!b){if(m&&m.includes("maxresdefault.jpg")){const d=m.replace("maxresdefault.jpg","hqdefault.jpg");f(d),p(!0);return}p(!0)}},j=a.type==="video"&&m&&m.includes("img.youtube.com");if(a.type==="photo"||j)return e.jsx("img",{src:m,alt:a.title,className:"w-full h-full object-cover",loading:"lazy",onError:y,style:{objectPosition:"center"}});if(a.type==="video"){const l=I(a.url);return l.match(/\.(jpeg|jpg|png|gif|webp)$/i)?e.jsx("img",{src:l,alt:a.title,className:"w-full h-full object-cover",loading:"lazy",style:{objectPosition:"center"}}):e.jsxs("div",{className:"w-full h-full bg-slate-100 relative overflow-hidden flex items-center justify-center group-hover:bg-slate-200 transition-colors",children:[e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center text-slate-400 gap-2",children:[e.jsx(L,{size:32,className:"opacity-50"}),e.jsx("span",{className:"text-[10px] font-medium opacity-50",children:"Video"})]}),e.jsx("video",{src:l,className:"w-full h-full object-cover relative z-10",muted:!0,playsInline:!0,loop:!0,onMouseEnter:n=>n.target.play().catch(()=>{}),onMouseLeave:n=>{n.target.pause(),n.target.currentTime=.1},style:{objectPosition:"center"}})]})}return e.jsx("div",{className:"w-full h-full bg-slate-100 flex items-center justify-center",children:e.jsx(L,{size:32,className:"text-slate-400 opacity-50"})})};function je({galleries:a}){const{success:m}=W().props,[f,b]=r.useState(!1),[p,y]=r.useState(!1),[j,l]=r.useState(null),[d,n]=r.useState("list"),[M,P]=r.useState(0),[u,v]=r.useState(null),[T,C]=r.useState(a),R=["Kegiatan Sekolah","Prestasi","Fasilitas","Alumni","Lainnya"],{data:s,setData:c,post:D,put:se,delete:G,processing:E,errors:w,reset:q}=X({title:"",description:"",type:"photo",file:null,url:"",is_external:!1,category:"",is_featured:!0});r.useEffect(()=>()=>{u&&u.startsWith("blob:")&&URL.revokeObjectURL(u)},[u]),r.useEffect(()=>{if(s.file instanceof File){u&&u.startsWith("blob:")&&URL.revokeObjectURL(u);const t=URL.createObjectURL(s.file);v(t)}else s.url?v(I(s.url)):v(null)},[s.file,s.url]);const O=[{key:"list",label:"Galeri Foto & Video",description:"Kelola dokumentasi visual.",icon:z}],N=(t=null)=>{P(i=>i+1),t?(y(!0),l(t.id),c({title:t.title||"",description:t.description||"",type:t.type||"photo",file:null,url:t.url||"",is_external:!!t.is_external,category:t.category||"",is_featured:!!t.is_featured})):(y(!1),l(null),c({title:"",description:"",type:"photo",file:null,url:"",is_external:!1,category:"",is_featured:!0})),b(!0)},x=()=>{b(!1),q()},K=t=>{if(t.preventDefault(),p){const i=new FormData;Object.keys(s).forEach(o=>{o==="file"?s.file instanceof File&&i.append("file",s.file):o==="is_featured"||o==="is_external"?i.append(o,s[o]?"1":"0"):i.append(o,s[o]||"")}),i.append("_method","PUT");const A=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content");fetch(route("admin.galleries.update",j),{method:"POST",headers:{"X-Requested-With":"XMLHttpRequest",Accept:"application/json","X-CSRF-TOKEN":A},body:i}).then(o=>{if(o.ok)C(k=>k.map(S=>S.id===j?{...S,title:s.title,description:s.description,type:s.type,url:s.url,category:s.category,is_featured:s.is_featured,is_external:s.is_external,...s.file instanceof File?{url:s.url}:{}}:S)),x(),g.success("Item galeri berhasil diperbarui");else return o.json().then(k=>{throw g.error("Gagal memperbarui item galeri"),k})}).catch(o=>{g.error("Gagal memperbarui item galeri")})}else D(route("admin.galleries.store"),{forceFormData:!0,preserveScroll:!0,onSuccess:i=>{x(),i.props&&i.props.galleries&&C(i.props.galleries),g.success("Item galeri baru berhasil ditambahkan")}})},V=t=>{confirm("Apakah Anda yakin ingin menghapus item galeri ini?")&&G(route("admin.galleries.destroy",t),{preserveScroll:!0,onSuccess:()=>g.success("Item galeri berhasil dihapus")})};return e.jsxs(H,{headerTitle:"Kelola Galeri",headTitle:"Galeri Sekolah",tabs:O,activeTab:d,setActiveTab:n,noForm:!0,children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden",children:[e.jsxs("div",{className:"p-5 border-b border-gray-200 flex flex-col sm:flex-row justify-between items-start sm:items-center gap-3",children:[e.jsx("h3",{className:"font-bold text-gray-900 text-lg",children:"Galeri Foto & Video"}),e.jsxs(_,{type:"button",onClick:()=>N(),className:"!bg-accent-yellow !text-gray-900 hover:!bg-yellow-500 flex items-center gap-2 px-4 py-2 text-sm font-medium w-full sm:w-auto justify-center",children:[e.jsx(Y,{size:18}),"Tambah Item"]})]}),e.jsx("div",{className:"p-4 sm:p-6",children:T.length>0?e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-3 sm:gap-4",children:T.map(t=>e.jsxs("div",{className:"group bg-white border border-gray-100 rounded-lg sm:rounded-xl overflow-hidden shadow-sm hover:shadow-md transition-all",children:[e.jsxs("div",{className:"aspect-square bg-gray-100 relative",children:[e.jsx(te,{item:t}),e.jsxs("div",{className:"absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center gap-2 z-20",children:[e.jsx("button",{onClick:()=>N(t),className:"p-2 bg-white/90 rounded-full text-accent-yellow hover:bg-white",children:e.jsx($,{size:16})}),e.jsx("button",{onClick:()=>V(t.id),className:"p-2 bg-white/90 rounded-full text-red-600 hover:bg-white",children:e.jsx(Q,{size:16})})]}),t.is_featured&&e.jsxs("div",{className:"absolute top-2 left-2 px-2 py-1 bg-yellow-500 text-white text-[10px] sm:text-xs font-bold rounded flex items-center gap-1",children:[e.jsx(Z,{size:10,className:"sm:size-3"})," Featured"]}),t.type==="video"&&e.jsx("div",{className:"absolute top-2 right-2 px-2 py-1 bg-red-600 text-white text-[10px] sm:text-xs font-bold rounded",children:"Video"})]}),e.jsxs("div",{className:"p-2 sm:p-3",children:[e.jsx("h4",{className:"font-semibold text-gray-800 text-xs sm:text-sm truncate",children:t.title}),e.jsxs("div",{className:"flex justify-between items-center mt-1",children:[e.jsx("span",{className:"text-[10px] sm:text-xs text-gray-500 bg-gray-100 px-2 py-0.5 rounded",children:t.category||"-"}),e.jsx("span",{className:"text-[10px] sm:text-xs text-gray-400",children:t.date?new Date(t.date).toLocaleDateString("id-ID",{day:"numeric",month:"short",year:"numeric"}):"-"})]})]})]},t.id))}):e.jsxs("div",{className:"p-8 sm:p-12 text-center",children:[e.jsx("div",{className:"w-12 h-12 sm:w-16 sm:h-16 rounded-full bg-gray-100 flex items-center justify-center mx-auto mb-4",children:e.jsx(z,{size:24,className:"sm:w-8 sm:h-8 text-gray-400"})}),e.jsx("p",{className:"text-gray-500 font-medium mb-4 text-sm sm:text-base",children:"Belum ada item"}),e.jsx(_,{onClick:()=>N(),className:"!bg-accent-yellow !text-gray-900 hover:!bg-yellow-500 text-sm sm:text-base px-4 py-2",children:"Tambah Item"})]})})]}),e.jsx(J,{show:f,onClose:x,maxWidth:"2xl",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl max-w-2xl w-full mx-auto max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"p-4 sm:p-6 border-b border-gray-200 flex justify-between items-center sticky top-0 bg-white z-10",children:[e.jsx("h3",{className:"text-lg sm:text-xl font-bold text-gray-900",children:p?"Edit Item":"Tambah Item"}),e.jsx("button",{onClick:x,className:"p-2 text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded-lg",children:e.jsx(ee,{size:20})})]}),e.jsxs("form",{onSubmit:K,className:"p-4 sm:p-6 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(h,{htmlFor:"title",value:"Judul"}),e.jsx(F,{id:"title",type:"text",className:"mt-1 block w-full",value:s.title,onChange:t=>c("title",t.target.value),required:!0,placeholder:"Judul..."}),e.jsx(U,{message:w.title,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"type",value:"Tipe"}),e.jsxs("select",{id:"type",className:"mt-1 block w-full border-gray-300 rounded-lg shadow-sm focus:border-accent-yellow text-sm",value:s.type,onChange:t=>c("type",t.target.value),children:[e.jsx("option",{value:"photo",children:"Foto"}),e.jsx("option",{value:"video",children:"Video"})]})]})]}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"description",value:"Deskripsi (Opsional)"}),e.jsx("textarea",{id:"description",className:"mt-1 block w-full border-gray-300 rounded-lg shadow-sm focus:border-accent-yellow text-sm",rows:"2",value:s.description,onChange:t=>c("description",t.target.value)})]}),e.jsxs("div",{className:"p-4 bg-gray-50 rounded-xl space-y-3",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"is_external",checked:s.is_external,onChange:t=>c("is_external",t.target.checked),className:"w-4 h-4 rounded border-gray-300 text-accent-yellow focus:ring-accent-yellow"}),e.jsx("span",{className:"text-sm font-medium",children:s.type==="video"?"Gunakan URL Eksternal (YouTube dll)":"Gunakan URL Eksternal"})]}),s.is_external?e.jsxs("div",{children:[e.jsx(h,{htmlFor:"url",value:"URL"}),e.jsx(F,{id:"url",type:"url",className:"mt-1 block w-full",value:s.url,onChange:t=>c("url",t.target.value),placeholder:"https://..."}),e.jsx(U,{message:w.url,className:"mt-2"})]}):e.jsx(B,{id:"gallery_file",label:s.type==="video"?"Upload Video":"Upload Foto",accept:s.type==="video"?"video/mp4,video/webm,video/quicktime":"image/*",fileType:s.type==="video"?"video":"image",previewUrl:u,onChange:t=>c("file",t),error:w.file})]}),e.jsx("div",{className:"grid grid-cols-1 gap-4",children:e.jsxs("div",{children:[e.jsx(h,{htmlFor:"category",value:"Kategori"}),e.jsx(F,{id:"category",type:"text",list:"category-options",className:"mt-1 block w-full",value:s.category,onChange:t=>c("category",t.target.value),placeholder:"Kategori..."}),e.jsx("datalist",{id:"category-options",children:R.map(t=>e.jsx("option",{value:t},t))})]})}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"is_featured_gallery",checked:s.is_featured,onChange:t=>c("is_featured",t.target.checked),className:"w-4 h-4 rounded border-gray-300 text-accent-yellow focus:ring-accent-yellow"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Featured"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-end gap-3 pt-4 border-t border-gray-200",children:[e.jsx("button",{type:"button",onClick:x,className:"px-4 py-2 text-gray-700 hover:text-gray-900 font-medium",children:"Batal"}),e.jsx(_,{type:"submit",disabled:E,className:"!bg-accent-yellow !text-gray-900 hover:!bg-yellow-500",children:E?"...":p?"Simpan":"Tambah"})]})]},M)]})})]})}export{je as default};
