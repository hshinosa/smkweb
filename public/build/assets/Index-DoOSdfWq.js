import{j as e}from"./markdown-vendor-CIGiOj7E.js";import{q as R,r as x,S as q,J as I,f as W}from"./inertia-vendor-CFsdYvsV.js";import{T as X}from"./TextInput-DXlIWAoE.js";import{I as c}from"./InputLabel-B7Cy73bq.js";import{I as P}from"./InputError-CW7Z9Fko.js";import{P as H}from"./PrimaryButton-BP4GzKQS.js";import{F as Q}from"./FileUploadField-DGzk2RBu.js";import{M as V}from"./MiniTextEditor-CT14-nLM.js";import{C as Y}from"./ContentManagementPage-CS4dHDNy.js";import{M as Z}from"./Modal-rJC0U0UH.js";import{z as u}from"./app-SCjtbprB.js";import{$ as F,E as ee,P as ae,T as te,t as se,a as re,e as S,X as D,I as le}from"./ui-vendor-DKvpuSCb.js";import"./react-vendor-X_fu8xpB.js";import"./typography-ChUjANkt.js";import"./AdminLayout-BYuG-4eb.js";import"./transition-CiB-21bZ.js";import"./index-CjLAxSrQ.js";function ke({posts:h}){const{success:ie}=R().props,[M,p]=x.useState(!1),[j,v]=x.useState(!1),[C,N]=x.useState(null),[z,A]=x.useState("list"),[T,m]=x.useState(!1),[n,f]=x.useState(1),b=7,g=Math.ceil(h.length/b),G=h.slice((n-1)*b,n*b),{data:t,setData:l,post:E,put:U,delete:K,processing:B,errors:w,reset:y}=q({title:"",category:"Berita",content:"",excerpt:"",featured_image:null,featured_image_url:"",images:[],status:"published"}),L=[{key:"list",label:"Berita & Pengumuman",description:"Kelola konten berita.",icon:F}],k=(a=null)=>{if(a){v(!0),N(a.id);let s=[];if(a.gallery&&Array.isArray(a.gallery)&&(s=a.gallery.map(i=>i.original_url)),a.scraped_images&&Array.isArray(a.scraped_images)){const i=s.map(r=>r?r.split("/").pop():"");a.scraped_images.forEach(r=>{const d=r.split("/").pop();i.some(o=>o.includes(d)||d.includes(o))||s.push(r)})}else s.length===0&&a.images&&Array.isArray(a.images)&&(s=a.images);l({title:a.title||"",category:a.category||"Berita",content:a.content||"",excerpt:a.excerpt||"",featured_image:null,featured_image_url:a.featuredImage?.original_url||a.featured_image||"",images:s,status:a.status||"published"})}else v(!1),N(null),y();p(!0)},_=()=>{p(!1),y()},$=a=>{if(a.preventDefault(),console.log("[PostSubmit] Form data before submit:",{title:t.title,titleLength:t.title?.length,content:t.content?.substring(0,100),contentLength:t.content?.length,category:t.category,status:t.status,excerpt:t.excerpt?.substring(0,50),featured_image:t.featured_image,images:t.images?.map(r=>r instanceof File?`File: ${r.name}`:typeof r=="string"?r.substring(0,50):r),imagesCount:t.images?.length}),t.featured_image instanceof File){const d=["image/jpeg","image/jpg","image/png","image/gif","image/webp"];if(t.featured_image.size>10485760){u.error("Ukuran file maksimal 10MB");return}if(!d.includes(t.featured_image.type)){u.error("Format file harus JPG, PNG, GIF, atau WebP");return}}const s=t.images&&t.images.some(r=>r instanceof File),i=t.featured_image instanceof File||s;if(console.log("[PostSubmit] needsFormData:",i,"hasFileInImages:",s),j)if(i){const r=[],d=[];t.images&&t.images.length>0&&t.images.forEach(o=>{o instanceof File?d.push(o):typeof o=="string"&&r.push(o)}),console.log("[PostSubmit] Using router.post with _method PUT for edit with files"),console.log("[PostSubmit] existingImages:",r.length,"newImages:",d.length),W.post(route("admin.posts.update",C),{_method:"PUT",title:t.title,category:t.category,content:t.content,excerpt:t.excerpt,status:t.status,featured_image:t.featured_image instanceof File?t.featured_image:null,existing_images:JSON.stringify(r),new_images:d},{forceFormData:!0,preserveState:!0,onSuccess:()=>{y(),p(!1),v(!1),N(null),u.success("Berita berhasil diperbarui")}})}else U(route("admin.posts.update",C),{preserveState:!0,onSuccess:()=>{y(),p(!1),v(!1),N(null),u.success("Berita berhasil diperbarui")}});else E(route("admin.posts.store"),{forceFormData:i,onSuccess:()=>{y(),p(!1),u.success("Berita baru berhasil dipublikasikan")}})},J=a=>{confirm("Apakah Anda yakin ingin menghapus berita ini? Tindakan ini tidak dapat dibatalkan.")&&K(route("admin.posts.destroy",a),{preserveScroll:!0,onSuccess:()=>u.success("Berita berhasil dihapus")})},O=e.jsxs("button",{onClick:()=>k(),className:"flex items-center gap-2 px-4 py-2 !bg-accent-yellow !text-gray-900 rounded-lg hover:!bg-yellow-500 transition-colors text-sm font-bold shadow-sm",children:[e.jsx(S,{size:18}),"Tulis Berita"]});return e.jsxs(Y,{headerTitle:"Kelola Berita",headTitle:"Berita & Pengumuman",tabs:L,activeTab:z,setActiveTab:A,noForm:!0,customAction:O,children:[e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden",children:h.length>0?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-500 uppercase",children:"Gambar"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-500 uppercase",children:"Judul"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-500 uppercase hidden md:table-cell",children:"Kategori"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-500 uppercase",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-semibold text-gray-500 uppercase",children:"Aksi"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100",children:G.map(a=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:e.jsx("div",{className:"h-12 w-16 rounded-lg overflow-hidden bg-gray-100",children:a.featuredImage?.original_url||a.featured_image?e.jsx("img",{src:a.featuredImage?.original_url||a.featured_image,alt:a.title,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsx(F,{className:"text-gray-400 w-6 h-6"})})})}),e.jsxs("td",{className:"px-4 py-3",children:[e.jsx("p",{className:"font-semibold text-gray-900 text-sm truncate max-w-[120px] sm:max-w-none",children:a.title}),e.jsx("p",{className:"text-xs text-gray-500 font-mono hidden sm:block",children:a.slug})]}),e.jsx("td",{className:"px-4 py-3 hidden md:table-cell",children:e.jsx("span",{className:"inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-700",children:a.category})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium ${a.status==="published"?"bg-green-100 text-green-700":"bg-gray-100 text-gray-600"}`,children:a.status==="published"?"Publis":"Draft"})}),e.jsx("td",{className:"px-4 py-3 text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:[e.jsx(I,{href:`/berita/${a.slug}`,target:"_blank",className:"p-2 text-gray-600 hover:bg-gray-100 rounded-lg",children:e.jsx(ee,{size:16})}),e.jsx("button",{onClick:()=>k(a),className:"p-2 !text-accent-yellow hover:bg-accent-yellow/10 rounded-lg",children:e.jsx(ae,{size:16})}),e.jsx("button",{onClick:()=>J(a.id),className:"p-2 text-red-600 hover:bg-red-50 rounded-lg",children:e.jsx(te,{size:16})})]})})]},a.id))})]})}),g>1&&e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 sm:px-6 border-t border-gray-200 bg-gray-50",children:[e.jsxs("div",{className:"flex justify-between w-full sm:hidden",children:[e.jsx("button",{onClick:()=>f(a=>Math.max(a-1,1)),disabled:n===1,className:"relative inline-flex items-center px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Previous"}),e.jsx("button",{onClick:()=>f(a=>Math.min(a+1,g)),disabled:n===g,className:"relative ml-3 inline-flex items-center px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Next"})]}),e.jsxs("div",{className:"hidden sm:flex-1 sm:flex sm:items-center sm:justify-between",children:[e.jsx("div",{children:e.jsxs("p",{className:"text-sm text-gray-700",children:["Showing ",e.jsx("span",{className:"font-medium",children:(n-1)*b+1})," to ",e.jsx("span",{className:"font-medium",children:Math.min(n*b,h.length)})," of ",e.jsx("span",{className:"font-medium",children:h.length})," results"]})}),e.jsx("div",{className:"flex gap-2",children:e.jsxs("nav",{className:"relative z-0 inline-flex rounded-md shadow-sm -space-x-px","aria-label":"Pagination",children:[e.jsxs("button",{onClick:()=>f(a=>Math.max(a-1,1)),disabled:n===1,className:"relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx("span",{className:"sr-only",children:"Previous"}),e.jsx(se,{className:"h-5 w-5","aria-hidden":"true"})]}),[...Array(g)].map((a,s)=>e.jsx("button",{onClick:()=>f(s+1),className:`relative inline-flex items-center px-4 py-2 border text-sm font-medium ${n===s+1?"z-10 bg-accent-yellow border-accent-yellow text-gray-900":"bg-white border-gray-300 text-gray-500 hover:bg-gray-50"}`,children:s+1},s)),e.jsxs("button",{onClick:()=>f(a=>Math.min(a+1,g)),disabled:n===g,className:"relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx("span",{className:"sr-only",children:"Next"}),e.jsx(re,{className:"h-5 w-5","aria-hidden":"true"})]})]})})]})]})]}):e.jsxs("div",{className:"p-8 sm:p-12 text-center",children:[e.jsx("div",{className:"w-12 h-12 sm:w-16 sm:h-16 rounded-full bg-gray-100 flex items-center justify-center mx-auto mb-4",children:e.jsx(F,{size:24,className:"sm:w-8 sm:h-8 text-gray-400"})}),e.jsx("p",{className:"text-gray-500 font-medium mb-4 text-sm sm:text-base",children:"Belum ada berita"}),e.jsxs("button",{onClick:()=>k(),className:"flex items-center gap-2 px-4 py-2 !bg-accent-yellow !text-gray-900 rounded-lg hover:!bg-yellow-500 transition-colors text-sm font-medium mx-auto",children:[e.jsx(S,{size:18}),"Tulis Berita"]})]})}),e.jsx(Z,{show:M,onClose:_,maxWidth:"6xl",children:e.jsxs("div",{className:"bg-white rounded-xl sm:rounded-2xl shadow-xl max-w-6xl w-full mx-auto max-h-[95vh] overflow-y-auto",children:[e.jsxs("div",{className:"p-4 sm:p-6 border-b border-gray-200 flex justify-between items-center sticky top-0 bg-white z-10",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg sm:text-xl font-bold text-gray-900",children:j?"Edit Berita":"Berita Baru"}),e.jsx("p",{className:"text-xs sm:text-sm text-gray-500 mt-0.5",children:j?"Perbarui":"Buat baru"})]}),e.jsx("button",{onClick:_,className:"p-2 text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded-lg",children:e.jsx(D,{size:20})})]}),e.jsxs("form",{onSubmit:$,className:"p-4 sm:p-6 space-y-6",children:[e.jsxs("div",{className:"bg-white border-2 border-gray-200 rounded-xl p-6 space-y-4",children:[e.jsxs("div",{className:"border-b pb-3",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-900 flex items-center gap-2",children:[e.jsx("span",{className:"bg-primary text-white rounded-full w-6 h-6 flex items-center justify-center text-sm",children:"1"}),"Informasi Berita"]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Detail utama berita atau pengumuman"})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"title",value:"Judul"}),e.jsx(X,{id:"title",type:"text",className:"mt-1 block w-full",value:t.title,onChange:a=>l("title",a.target.value),required:!0,placeholder:"Judul..."}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Buat judul yang menarik dan informatif"}),e.jsx(P,{message:w.title,className:"mt-2"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(c,{htmlFor:"category",value:"Kategori"}),e.jsxs("select",{id:"category",className:"mt-1 block w-full border-gray-300 rounded-lg shadow-sm focus:border-accent-yellow text-sm",value:t.category,onChange:a=>l("category",a.target.value),children:[e.jsx("option",{value:"Berita",children:"Berita"}),e.jsx("option",{value:"Pengumuman",children:"Pengumuman"}),e.jsx("option",{value:"Prestasi",children:"Prestasi"}),e.jsx("option",{value:"Akademik",children:"Akademik"}),e.jsx("option",{value:"Kegiatan",children:"Kegiatan"})]}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Kategori konten"})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"status",value:"Status"}),e.jsxs("select",{id:"status",className:"mt-1 block w-full border-gray-300 rounded-lg shadow-sm focus:border-accent-yellow text-sm",value:t.status,onChange:a=>l("status",a.target.value),children:[e.jsx("option",{value:"published",children:"Publis"}),e.jsx("option",{value:"draft",children:"Draft"})]}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Status publikasi"})]})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"excerpt",value:"Ringkasan"}),e.jsx("textarea",{id:"excerpt",className:"mt-1 block w-full border-gray-300 rounded-lg shadow-sm focus:border-accent-yellow text-sm",rows:"3",value:t.excerpt,onChange:a=>l("excerpt",a.target.value),required:!0}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Ringkasan singkat yang muncul di daftar berita"}),e.jsx(P,{message:w.excerpt,className:"mt-2"})]})]}),e.jsxs("div",{className:"bg-white border-2 border-gray-200 rounded-xl p-6 space-y-4",children:[e.jsxs("div",{className:"border-b pb-3",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-900 flex items-center gap-2",children:[e.jsx("span",{className:"bg-primary text-white rounded-full w-6 h-6 flex items-center justify-center text-sm",children:"2"}),"Media Berita"]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Upload atau tinjau gambar untuk berita ini"})]}),e.jsxs("div",{children:[e.jsx(c,{value:"Gambar Utama (Thumbnail)",className:"mb-2"}),e.jsx(Q,{id:"featured_image",onChange:a=>l("featured_image",a),previewUrl:t.featured_image_url,label:"Upload Thumbnail"})]}),t.images&&t.images.length>0&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-100",children:[e.jsx(c,{value:`Gambar Tambahan (${t.images.length})`,className:"mb-2"}),e.jsxs("div",{className:"grid grid-cols-3 sm:grid-cols-4 md:grid-cols-5 lg:grid-cols-6 gap-3",children:[t.images.map((a,s)=>e.jsxs("div",{className:"relative group aspect-square rounded-lg overflow-hidden border border-gray-200 shadow-sm",children:[e.jsx("img",{src:typeof a=="string"?a:URL.createObjectURL(a),alt:`Gallery ${s}`,className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute top-1 right-1 opacity-100 sm:opacity-0 group-hover:opacity-100 transition-opacity z-10",children:e.jsx("button",{type:"button",onClick:()=>{const i=[...t.images];i.splice(s,1),l("images",i)},className:"p-1 bg-white/90 text-red-600 rounded-full hover:bg-white shadow-sm border border-gray-200",children:e.jsx(D,{size:14})})}),e.jsx("div",{className:"absolute bottom-1 right-1 bg-black/60 text-white text-[9px] px-1.5 py-0.5 rounded-full font-mono backdrop-blur-sm",children:typeof a=="string"&&a.includes("scraped-images")?"IG":typeof a=="string"?"Saved":"New"})]},s)),e.jsxs("label",{htmlFor:"additional_images_grid",className:`relative aspect-square rounded-lg border-2 border-dashed cursor-pointer flex flex-col items-center justify-center transition-all ${T?"border-primary bg-primary/5 scale-105":"border-gray-300 hover:border-primary hover:bg-gray-50"}`,onDragOver:a=>{a.preventDefault(),m(!0)},onDragLeave:()=>m(!1),onDrop:a=>{if(a.preventDefault(),m(!1),a.dataTransfer.files&&a.dataTransfer.files.length>0){const s=Array.from(a.dataTransfer.files);l("images",[...t.images||[],...s])}},children:[e.jsx(S,{size:24,className:"text-gray-400 mb-1"}),e.jsx("span",{className:"text-[10px] text-gray-500 font-medium text-center px-1",children:"Tambah Gambar"}),e.jsx("input",{id:"additional_images_grid",type:"file",accept:"image/*",multiple:!0,className:"hidden",onChange:a=>{if(a.target.files&&a.target.files.length>0){const s=Array.from(a.target.files);l("images",[...t.images||[],...s])}}})]})]}),e.jsx("p",{className:"text-[10px] text-gray-500 mt-2 italic",children:"* Media yang ditarik otomatis dari Instagram atau upload manual."})]}),(!t.images||t.images.length===0)&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-100",children:[e.jsx(c,{value:"Gambar Tambahan",className:"mb-2"}),e.jsxs("label",{htmlFor:"additional_images_empty",className:`relative flex flex-col items-center justify-center w-full h-32 rounded-xl border-2 border-dashed cursor-pointer transition-all ${T?"border-primary bg-primary/5":"border-gray-300 hover:border-primary hover:bg-gray-50"}`,onDragOver:a=>{a.preventDefault(),m(!0)},onDragLeave:()=>m(!1),onDrop:a=>{if(a.preventDefault(),m(!1),a.dataTransfer.files&&a.dataTransfer.files.length>0){const s=Array.from(a.dataTransfer.files);l("images",[...t.images||[],...s])}},children:[e.jsx(le,{size:32,className:"text-gray-400 mb-2"}),e.jsx("span",{className:"text-sm text-gray-500 font-medium",children:"Klik atau drag gambar ke sini"}),e.jsx("span",{className:"text-xs text-gray-400 mt-1",children:"Format: JPEG, PNG, GIF, WebP"}),e.jsx("input",{id:"additional_images_empty",type:"file",accept:"image/*",multiple:!0,className:"hidden",onChange:a=>{if(a.target.files&&a.target.files.length>0){const s=Array.from(a.target.files);l("images",[...t.images||[],...s])}}})]})]})]}),e.jsxs("div",{className:"bg-white border-2 border-gray-200 rounded-xl p-6 space-y-4",children:[e.jsxs("div",{className:"border-b pb-3",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-900 flex items-center gap-2",children:[e.jsx("span",{className:"bg-primary text-white rounded-full w-6 h-6 flex items-center justify-center text-sm",children:"3"}),"Konten Berita"]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Isi lengkap berita atau pengumuman"})]}),e.jsx(V,{value:t.content,onChange:a=>l("content",a)}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Gunakan editor untuk format teks, gambar, dan link"}),e.jsx(P,{message:w.content,className:"mt-2"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-end gap-3 mt-6 pt-4 border-t border-gray-200",children:[e.jsx("button",{type:"button",onClick:_,className:"px-4 py-2 text-gray-700 hover:text-gray-900 font-medium",children:"Batal"}),e.jsx(H,{type:"submit",disabled:B,className:"!bg-accent-yellow !text-gray-900 hover:!bg-yellow-500 px-5 py-2",children:B?"...":j?"Simpan":"Publikasikan"})]})]})]})})]})}export{ke as default};
