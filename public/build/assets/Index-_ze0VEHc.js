import{j as e}from"./markdown-vendor-CIGiOj7E.js";import{q as B,r as m,S as V,f as j,a as $}from"./inertia-vendor-CFsdYvsV.js";import{P as Q}from"./PrimaryButton-BP4GzKQS.js";import{T as i}from"./TextInput-DXlIWAoE.js";import{I as o}from"./InputLabel-B7Cy73bq.js";import{C as W}from"./ContentManagementPage-DVU9nbB8.js";import{z as p}from"./app-BjrorLXI.js";import{f as X,K as Y,g as Z,e as H,T as ee,M as se,F as ae,h as te}from"./ui-vendor-DKvpuSCb.js";import"./react-vendor-X_fu8xpB.js";import"./typography-ChUjANkt.js";import"./AdminLayout-BGv0ni_W.js";import"./transition-CiB-21bZ.js";function je({settings:S,apifyToken:C,embeddingHealth:x,queueHealth:g}){const{success:re}=B().props,q=new URLSearchParams(window.location.search).get("tab")||"groq",[u,P]=m.useState(q),[I,b]=m.useState(!1),[T,y]=m.useState(!1),[h,M]=m.useState([]),[D,f]=m.useState(!1),r={};S.forEach(s=>{r[s.key]=s.value});const F=s=>{if(Array.isArray(s))return s;if(!s)return[""];try{const a=JSON.parse(s);return Array.isArray(a)&&a.length>0?a:[""]}catch{return s?[s]:[""]}},[c,v]=m.useState(F(r.groq_api_keys)),[k,K]=m.useState(C||""),{data:_,setData:R,post:ne,processing:ie,errors:de}=V({settings:[{key:"groq_api_keys",value:JSON.stringify(c.filter(s=>s.trim()))},{key:"groq_chat_model",value:r.groq_chat_model||"llama-3.1-8b-instant"},{key:"groq_content_model",value:r.groq_content_model||"llama-3.3-70b-versatile"},{key:"embedding_provider",value:r.embedding_provider||"tei"},{key:"embedding_base_url",value:r.embedding_base_url||"http://embedding:8080"},{key:"embedding_model",value:r.embedding_model||"intfloat/multilingual-e5-small"},{key:"embedding_dimensions",value:r.embedding_dimensions||"384"},{key:"ai_max_tokens",value:r.ai_max_tokens||"2000"},{key:"ai_temperature",value:r.ai_temperature||"0.7"},{key:"rag_enabled",value:r.rag_enabled||"1"},{key:"rag_top_k",value:r.rag_top_k||"5"},{key:"queue_alert_pending_threshold",value:r.queue_alert_pending_threshold||"100"},{key:"queue_alert_failed_threshold",value:r.queue_alert_failed_threshold||"1"}]}),G=[{key:"groq",label:"Groq AI",description:"Konfigurasi Groq API untuk chat dan generate konten.",icon:X},{key:"apify",label:"Apify API",description:"Konfigurasi Apify API untuk Instagram scraper.",icon:Y},{key:"rag",label:"RAG Settings",description:"Pengaturan Retrieval Augmented Generation.",icon:Z}],N=async()=>{f(!0);try{const s=await $.get(route("admin.ai-settings.models"));s.data.success&&M(s.data.models||[])}catch(s){console.error("Failed to fetch models:",s)}finally{f(!1)}};m.useEffect(()=>{const s=a=>{a.target.closest(".model-dropdown-container")||(b(!1),y(!1))};return document.addEventListener("mousedown",s),()=>document.removeEventListener("mousedown",s)},[]);const n=(s,a)=>{const l=_.settings.map(t=>t.key===s?{...t,value:a}:t);R("settings",l)},d=s=>_.settings.find(a=>a.key===s)?.value||"",w=s=>{s.preventDefault();const a=JSON.stringify(c.filter(t=>t.trim())),l=_.settings.map(t=>t.key==="groq_api_keys"?{...t,value:a}:t);j.post(route("admin.ai-settings.update"),{settings:l},{preserveScroll:!0,preserveState:!1,onSuccess:()=>p.success("Pengaturan AI berhasil diperbarui")})},E=s=>{s.preventDefault(),j.post(route("admin.ai-settings.apify-token.update"),{apify_token:k},{preserveScroll:!0,preserveState:!1,onSuccess:()=>p.success("Apify API key berhasil disimpan")})},J=(s,a)=>{n(s,a),b(!1),y(!1)},L=()=>{j.post(route("admin.ai-settings.reindex-db-content"),{},{preserveScroll:!0,onSuccess:()=>p.success("Reindex database content dimulai."),onError:()=>p.error("Gagal memulai reindex database content.")})},O=()=>{v([...c,""])},z=s=>{c.length<=1||v(c.filter((a,l)=>l!==s))},U=(s,a)=>{const l=[...c];l[s]=a,v(l)},A=({field:s,show:a,setShow:l})=>e.jsxs("div",{className:"relative model-dropdown-container z-50",children:[e.jsx(o,{htmlFor:s,value:s==="groq_chat_model"?"Model Chat (Chatbot/RAG)":"Model Konten (Generate Berita)"}),e.jsx("div",{className:"flex items-center gap-2 mt-1",children:e.jsx("div",{className:"flex-1 flex items-center gap-1.5 text-xs text-gray-500",children:s==="groq_chat_model"?e.jsxs(e.Fragment,{children:[e.jsx(se,{className:"w-3.5 h-3.5"})," Untuk chatbot dan RAG"]}):e.jsxs(e.Fragment,{children:[e.jsx(ae,{className:"w-3.5 h-3.5"})," Untuk generate artikel berita"]})})}),e.jsxs("div",{className:"relative mt-1",children:[e.jsx(i,{id:s,type:"text",className:"mt-1 block w-full pr-10",value:d(s),onChange:t=>n(s,t.target.value),onFocus:()=>{l(!0),h.length===0&&N()},placeholder:s==="groq_chat_model"?"llama-3.1-8b-instant":"llama-3.3-70b-versatile"}),e.jsx("button",{type:"button",onClick:()=>{l(!a),!a&&h.length===0&&N()},className:"absolute right-0 top-1/2 -translate-y-1/2 pr-3 flex items-center",children:e.jsx(te,{className:"w-5 h-5 text-gray-400"})})]}),a&&e.jsx("div",{className:"absolute z-50 left-0 right-0 bottom-full mb-1 bg-white border border-gray-300 rounded-md shadow-xl max-h-60 overflow-y-auto",children:D?e.jsx("div",{className:"p-4 text-sm text-gray-500",children:"Loading models..."}):h.length>0?e.jsx("div",{className:"py-1",children:h.map(t=>e.jsxs("button",{type:"button",onClick:()=>J(s,t.id),className:"w-full text-left px-4 py-2 hover:bg-gray-100 text-sm flex items-center justify-between border-b border-gray-100 last:border-b-0",children:[e.jsx("span",{children:t.id}),t.owned_by&&e.jsx("span",{className:"text-xs text-gray-400 capitalize",children:t.owned_by})]},t.id))}):e.jsx("div",{className:"p-4 text-sm text-gray-500",children:"Tidak ada model. Tambahkan API Key terlebih dahulu."})})]});return e.jsx(W,{headerTitle:"AI Settings",headTitle:"AI Settings",tabs:G,activeTab:u,setActiveTab:P,onSave:w,children:e.jsxs("form",{onSubmit:w,className:"space-y-6",children:[u==="groq"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-white shadow-sm rounded-xl border border-gray-200 overflow-hidden",children:e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-900",children:"Groq API Keys"}),e.jsx("p",{className:"text-xs text-gray-500 mt-0.5",children:"Tambahkan beberapa API key untuk round-robin (jika rate limited, otomatis pakai key berikutnya)."})]}),e.jsxs("button",{type:"button",onClick:O,className:"inline-flex items-center gap-1.5 px-3 py-1.5 text-xs font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-lg transition",children:[e.jsx(H,{className:"w-3.5 h-3.5"}),"Tambah Key"]})]}),e.jsx("div",{className:"space-y-2",children:c.map((s,a)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-xs text-gray-400 w-6 text-right",children:[a+1,"."]}),e.jsx(i,{type:"password",className:"flex-1",value:s,onChange:l=>U(a,l.target.value),placeholder:"gsk_xxxxxxxxxxxxx"}),c.length>1&&e.jsx("button",{type:"button",onClick:()=>z(a),className:"p-1.5 text-red-400 hover:text-red-600 hover:bg-red-50 rounded transition",children:e.jsx(ee,{className:"w-4 h-4"})})]},a))}),e.jsxs("p",{className:"text-xs text-blue-600 bg-blue-50 p-2 rounded",children:["Dapatkan API key gratis di ",e.jsx("a",{href:"https://console.groq.com/keys",target:"_blank",rel:"noopener noreferrer",className:"underline font-medium",children:"console.groq.com/keys"})]})]})}),e.jsx("div",{className:"bg-white shadow-sm rounded-xl border border-gray-200",children:e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-900",children:"Model AI"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(A,{field:"groq_chat_model",show:I,setShow:b}),e.jsx(A,{field:"groq_content_model",show:T,setShow:y})]})]})}),e.jsx("div",{className:"bg-white shadow-sm rounded-xl border border-gray-200 overflow-hidden",children:e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-900",children:"Embedding Service (Docker)"}),e.jsx("span",{className:`text-xs px-2 py-1 rounded ${x?.available?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,children:x?.available?"Online":"Offline"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(o,{htmlFor:"embedding_provider",value:"Provider"}),e.jsx(i,{id:"embedding_provider",type:"text",className:"mt-1 block w-full",value:d("embedding_provider"),onChange:s=>n("embedding_provider",s.target.value),placeholder:"tei"})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"embedding_base_url",value:"Base URL"}),e.jsx(i,{id:"embedding_base_url",type:"text",className:"mt-1 block w-full",value:d("embedding_base_url"),onChange:s=>n("embedding_base_url",s.target.value),placeholder:"http://embedding:8080"})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"embedding_model",value:"Embedding Model"}),e.jsx(i,{id:"embedding_model",type:"text",className:"mt-1 block w-full",value:d("embedding_model"),onChange:s=>n("embedding_model",s.target.value),placeholder:"intfloat/multilingual-e5-small"})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"embedding_dimensions",value:"Embedding Dimensions"}),e.jsx(i,{id:"embedding_dimensions",type:"number",className:"mt-1 block w-full",value:d("embedding_dimensions"),onChange:s=>n("embedding_dimensions",s.target.value),placeholder:"384"})]})]}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Health: ",x?.base_url||"-"," | Model: ",x?.model||"-"," | Dimensi: ",x?.dimensions||"-"]})]})}),e.jsx("div",{className:"bg-white shadow-sm rounded-xl border border-gray-200 overflow-hidden",children:e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-900",children:"Parameter"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(o,{htmlFor:"ai_max_tokens",value:"Max Tokens"}),e.jsx(i,{id:"ai_max_tokens",type:"number",className:"mt-1 block w-full",value:d("ai_max_tokens"),onChange:s=>n("ai_max_tokens",s.target.value),placeholder:"2000"})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"ai_temperature",value:"Temperature (0-1)"}),e.jsx(i,{id:"ai_temperature",type:"number",step:"0.1",className:"mt-1 block w-full",value:d("ai_temperature"),onChange:s=>n("ai_temperature",s.target.value),placeholder:"0.7"})]})]})]})})]}),u==="apify"&&e.jsx("div",{className:"space-y-6",children:e.jsx("div",{className:"bg-white shadow-sm rounded-xl border border-gray-200 overflow-hidden",children:e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-900",children:"Apify API Token"}),e.jsx("p",{className:"text-xs text-gray-500 mt-0.5",children:"Token API dari Apify untuk menjalankan Instagram scraper."})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"apify_token",value:"API Token"}),e.jsx(i,{id:"apify_token",type:"password",className:"mt-1 block w-full",value:k,onChange:s=>K(s.target.value),placeholder:"xxxxxx..."}),e.jsxs("p",{className:"mt-1 text-xs text-blue-600",children:["Dapatkan API token di ",e.jsx("a",{href:"https://console.apify.com/settings/integrations",target:"_blank",rel:"noopener noreferrer",className:"underline font-medium",children:"console.apify.com"})]})]}),e.jsx("div",{children:e.jsx(Q,{type:"button",onClick:E,className:"!bg-accent-yellow !text-gray-900 hover:!bg-yellow-500",children:"Simpan Apify Token"})})]})})}),u==="rag"&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"bg-white shadow-sm rounded-xl border border-gray-200 overflow-hidden",children:e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",id:"rag_enabled",checked:d("rag_enabled")==="1",onChange:s=>n("rag_enabled",s.target.checked?"1":"0"),className:"h-4 w-4 text-accent-yellow focus:ring-accent-yellow border-gray-300 rounded"}),e.jsx("label",{htmlFor:"rag_enabled",className:"ml-2 block text-sm font-medium text-gray-900",children:"Aktifkan RAG (Retrieval Augmented Generation)"})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"rag_top_k",value:"Top K Documents"}),e.jsx(i,{id:"rag_top_k",type:"number",className:"mt-1 block w-full md:w-1/2",value:d("rag_top_k"),onChange:s=>n("rag_top_k",s.target.value),placeholder:"5"}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Jumlah dokumen yang diambil untuk setiap query (default: 5)"})]}),e.jsx("div",{className:"p-3 bg-yellow-50 rounded-lg border border-yellow-200",children:e.jsxs("p",{className:"text-xs text-yellow-700",children:[e.jsx("strong",{children:"Catatan:"})," RAG menggunakan embedding service Docker + pgvector. Pastikan service embedding online."]})}),e.jsxs("div",{className:"p-4 rounded-lg border border-gray-200 bg-gray-50 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-900",children:"Queue Monitoring Alert"}),e.jsx("span",{className:`text-xs px-2 py-1 rounded ${g?.status==="alert"?"bg-red-100 text-red-700":"bg-green-100 text-green-700"}`,children:g?.status==="alert"?"Alert":"Normal"})]}),e.jsxs("div",{className:"text-xs text-gray-600 grid grid-cols-1 md:grid-cols-2 gap-2",children:[e.jsxs("p",{children:["Pending jobs saat ini: ",e.jsx("strong",{children:g?.pending_jobs??0})]}),e.jsxs("p",{children:["Failed jobs saat ini: ",e.jsx("strong",{children:g?.failed_jobs??0})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(o,{htmlFor:"queue_alert_pending_threshold",value:"Alert jika Pending Jobs >="}),e.jsx(i,{id:"queue_alert_pending_threshold",type:"number",className:"mt-1 block w-full",value:d("queue_alert_pending_threshold"),onChange:s=>n("queue_alert_pending_threshold",s.target.value),placeholder:"100"})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"queue_alert_failed_threshold",value:"Alert jika Failed Jobs >="}),e.jsx(i,{id:"queue_alert_failed_threshold",type:"number",className:"mt-1 block w-full",value:d("queue_alert_failed_threshold"),onChange:s=>n("queue_alert_failed_threshold",s.target.value),placeholder:"1"})]})]})]})]})}),e.jsx("div",{className:"bg-white shadow-sm rounded-xl border border-gray-200 overflow-hidden",children:e.jsxs("div",{className:"p-6 space-y-3",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-900",children:"Index Database Content"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Sinkronkan konten database publik ke RAG documents/chunks agar retrieval lebih lengkap."}),e.jsx("div",{children:e.jsx("button",{type:"button",onClick:L,className:"inline-flex items-center px-4 py-2 bg-accent-yellow text-black rounded-lg text-sm font-medium hover:opacity-90",children:"Reindex Database Content"})})]})})]})]})})}export{je as default};
